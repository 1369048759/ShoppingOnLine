function $namespace(name){for(var arr=name.split(","),r=0,len=arr.length;len>r;r++)for(var i=0,k,name=arr[r].split("."),parent={};k=name[i];i++)0===i?eval("(typeof "+k+')==="undefined"?('+k+'={}):"";parent='+k):parent=parent[k]=parent[k]||{}}function $id(id){return"string"==typeof id?document.getElementById(id):id}function $incNum(acc){return acc=acc||$incNum,acc.num=acc.num||0,acc.num++}function $bindEvent(dom,handle,type){function setHandler(dom,type,handler,wraper){var eid=dom.__eventId=dom.__eventId||$incNum();$bindEvent.__allHandlers=$bindEvent.__allHandlers||{},$bindEvent.__allHandlers[eid]=$bindEvent.__allHandlers[eid]||{},$bindEvent.__allHandlers[eid][type]=$bindEvent.__allHandlers[eid][type]||[],$bindEvent.__allHandlers[eid][type].push({handler:handler,wraper:wraper})}function createDelegate(handle,context){return function(e){return handle.call(context,e||window.event)}}if(dom&&handle)if(type=type||"click",dom instanceof Array)for(var i=0,l=dom.length;l>i;i++)$bindEvent(dom[i],handle,type);else if(type instanceof Array)for(var i=0,l=type.length;l>i;i++)$bindEvent(dom,handle,type[i]);else if(window.addEventListener){var wrapper=createDelegate(handle,dom);setHandler(dom,type,handle,wrapper),dom.addEventListener(type,wrapper,!1)}else if(window.attachEvent){var wrapper=createDelegate(handle,dom);setHandler(dom,type,handle,wrapper),dom.attachEvent("on"+type,wrapper)}else dom["on"+type]=handle}function $Tab(o,undefined){var othis=this;othis._selfID=++othis.constructor._newNum,othis._selfName=".$Tab"+othis._selfID,o&&(o.config!=undefined&&(othis.config=$.extend({},othis.config,o.config)),o.oTab!=undefined&&(othis.oTab=$(o.oTab)))}function $trim(str){return str.replace(/^\s+|\s$/g,"")}$namespace("sp.expeStore"),$Tab.prototype={config:{pos:0,isRandom:!1,selectorItem:".ui_tab_item",selectorPanel:".ui_tab_panel",selectorOption:".ui_tab_option",selectorOptions:".ui_tab_options",cssOptionCurr:"ui_tab_option_curr",onBeforeMove:null,onAfterMove:null,isDelay:!1},init:function(){var othis=this,cfg=othis.config;othis.oPanel=othis.oTab.find(othis.config.selectorPanel),othis.oItems=othis.oPanel.find(othis.config.selectorItem),othis.oOptionsCon=othis.oTab.find(othis.config.selectorOptions),othis.oOptions=othis.oOptionsCon.find(othis.config.selectorOption);var sum=othis.oOptions.length;return othis.sum=sum,0==sum?(othis.oTab.hide(),!1):(1==sum?(cfg.pos=0,othis.oOptions.hide()):(othis.oOptions.show(),cfg.isRandom&&(cfg.pos=Math.floor(sum*Math.random())),othis.oOptions.mouseenter(othis,othis.optionsEnterHandler),othis.oOptions.mouseleave(othis,othis.optionsLeaveHandler)),cfg.isDelay&&$(window).bind("resize"+othis._selfName+" scroll"+othis._selfName,othis,othis.fnDelay),othis.move(),void 0)},move:function(){this.config.onBeforeMove&&(this.onBeforeMove=this.config.onBeforeMove,this.onBeforeMove()),this.config.isDelay&&this.fnDelay(),this.movefunc(),this.config.onAfterMove&&(this.onAfterMove=this.config.onAfterMove,this.onAfterMove())},movefunc:function(){var othis=this,cfg=othis.config;othis.oItems.hide(),othis.oItems.eq(cfg.pos).show(),othis.oOptions.removeClass(cfg.cssOptionCurr),othis.oOptions.eq(cfg.pos).addClass(cfg.cssOptionCurr)},optionsEnterHandler:function(e){var othis=e.data,cfg=othis.config,oself=$(this);othis._delayTimeout=setTimeout(function(){clearTimeout(othis._delayTimeout);var index=othis.oOptions.index(oself);cfg.pos=index,othis.move()},200)},optionsLeaveHandler:function(e){clearTimeout(e.data._delayTimeout)},fnDelay:function(e){var oimgs,othis=e&&e.data||this;othis.oDelayImgs||(oimgs=othis.oTab.find("img"),othis.oDelayImgs=[],oimgs.each(function(){$(this).attr("orial_src")&&othis.oDelayImgs.push(this)}));var spos=othis.config.pos;oimgs=othis.oItems.eq(spos).find("img");var owin=$(window),scrollStart=owin.scrollTop(),winH=owin.height(),end=scrollStart+winH;oimgs.length,oimgs.each(function(){var oself=$(this);if(oself.attr("orial_src")){var offTop=parseInt(oself.offset().top),offBottom=parseInt(offTop+(oself.outerHeight()||800));if(offTop>=scrollStart&&end>=offTop||offBottom>=scrollStart&&end>=offBottom||scrollStart>offTop&&offBottom>end){oself.attr("src",oself.attr("orial_src"));for(var i=0;othis.oDelayImgs.length>i;i++)if(othis.oDelayImgs[i]==this){othis.oDelayImgs.splice(i,1),i--;break}}}}),0==othis.oDelayImgs.length&&(othis.config.isDelay=!1,$(window).unbind("resize"+othis._selfName+" scroll"+othis._selfName))}},$Tab.prototype.constructor=$Tab,$Tab._newNum=0,sp.expeStore.data={allStores:OFFLINESHOPS||[],districts:{},district:"",cities:{},city:"",stores:{},store:"",listStores:[],col:4},sp.expeStore.dom={district:$id("Jdistrict"),city:$id("Jcity"),list:$id("Jlist"),images:$id("Jimages"),pages:$id("Jpage")},sp.expeStore.init=function(){var that=this;that.formatDistrict();var values=that.initRange();that.setDistrict(values.district),that.createDistrict(),that.setCity(values.city),that.createCity(),that.setStore(values.store),that.createList();var index=this.getStoreIndex(),listStore=that.getListStore();that.createPages(listStore.length,that.data.col,index+1),that.createImages(listStore.length?listStore[index].image_list:null),$bindEvent(that.dom.district,function(){var value=this.value;that.setDistrict(value),that.createCity(),that.createList();var listStore=that.getListStore(),index=that.getStoreIndex();that.createPages(listStore.length,that.data.col,that.getStoreIndex()+1),that.createImages(listStore[index].image_list)},"change"),$bindEvent(that.dom.city,function(){var value=this.value;that.setCity(value),that.createList();var listStore=that.getListStore(),index=that.getStoreIndex();that.createPages(listStore.length,that.data.col,that.getStoreIndex()+1),that.createImages(listStore[index].image_list)},"change"),$bindEvent(that.dom.list,function(e){e=e||window.event;for(var tag,etarget=e.target||e.srcElement,elem=etarget;elem!==that.dom.list;){if(tag=elem.getAttribute("expItem_tag")){$(elem).hasClass("curr")&&(tag=!1);break}elem=elem.parentNode}if(tag){var expeStore=sp.expeStore;expeStore.setStore(tag),$(elem).parent().children().removeClass("serviceNet_li_focus"),$(elem).addClass("serviceNet_li_focus");var index=expeStore.getStoreIndex(),listStores=expeStore.getListStore();expeStore.createImages(listStores[index].image_list)}},"click"),$bindEvent(that.dom.pages,function(e){e=e||window.event;for(var tag,etarget=e.target||e.srcElement,elem=etarget;elem!==that.dom.pages;){if(tag=elem.getAttribute("page_tag")){$(elem).hasClass("ui_page_curr")&&(tag=!1);break}elem=elem.parentNode}if(tag){var expeStore=sp.expeStore,listStores=expeStore.getListStore();tag=(parseInt(tag)-1||0)*expeStore.data.col,expeStore.setStore(listStores[tag].shopName),expeStore.createList(),$(elem).parent().children().removeClass("ui_page_curr"),$(elem).addClass("ui_page_curr"),expeStore.createImages(listStores[tag].image_list)}e.preventDefault?e.preventDefault():window.event.returnValue=!1},"click")},sp.expeStore.initRange=function(){var strUrl=window.location.search||"",values={district:"",city:"",store:""};if(""===strUrl)return values;try{strUrl=decodeURIComponent(strUrl)}catch(e){try{strUrl=decodeURI(strUrl)}catch(e){try{strUrl=unescape(strUrl)}catch(e){}}}var value=strUrl.match(/(\?|\&)d=([^\&]*)(\&|$)/);return values.district=value?$trim(value[2]):"",value=strUrl.match(/(\?|\&)c=([^\&]*)(\&|$)/),values.city=value?$trim(value[2]):"",value=strUrl.match(/(\?|\&)s=([^\&]*)(\&|$)/),values.store=value?$trim(value[2]):"",values},sp.expeStore.formatDistrict=function(){for(var tempCity,districtName,disCities=this.data.allStores,formCites={},i=0,len=disCities.length;len>i;i++)tempCity=disCities[i],tempCity&&(districtName=$trim(tempCity.district),formCites[districtName]||(formCites[districtName]=[]),formCites[districtName].push(tempCity));this.data.districts=formCites},sp.expeStore.getDistricts=function(){return this.data.districts},sp.expeStore.setDistrict=function(district){this.data.district=$trim(district)||"",this.data.city="",this.data.cities=[],this.data.store="",this.data.stores=[];var data=this.data,stores=[],cities={};data.district&&data.districts[data.district]&&(stores=data.districts[data.district]);for(var tempCity,i=0,len=stores.length;len>i;i++)tempCity=stores[i],tempCity&&(tempCity=$trim(tempCity.cityName),cities[tempCity]||(cities[tempCity]=[]),cities[tempCity].push(stores[i]));data.cities=cities},sp.expeStore.createDistrict=function(){var districts=this.getDistricts(),select=-1,htmlArr=[],i=0;for(var prop in districts)districts.hasOwnProperty(prop)&&(htmlArr.push(prop),i++,prop===this.data.district&&(select=i));-1===select&&(select=0),this.dom.district.options.length=htmlArr.length+1,this.dom.district.options[0].value="",this.dom.district.options[0].innerHTML="请选择",this.dom.district.options[select].selected="selected";for(var i=0,len=htmlArr.length;len>i;i++)this.dom.district.options[i+1].value=htmlArr[i],this.dom.district.options[i+1].innerHTML=htmlArr[i]},sp.expeStore.getCities=function(){return this.data.cities},sp.expeStore.setCity=function(city){this.data.city=$trim(city)||"",this.data.store="",this.data.stores=[];var data=this.data,stores=[];data.city&&data.cities[data.city]&&(stores=data.cities[data.city]),this.data.stores=stores},sp.expeStore.createCity=function(){var cities=this.getCities(),select=-1;htmlArr=[],i=0;for(var prop in cities)cities.hasOwnProperty(prop)&&(htmlArr.push(prop),i++,prop===this.data.city&&(select=i));-1===select&&(select=0),this.dom.city.options.length=htmlArr.length+1,this.dom.city.options[0].value="",this.dom.city.options[0].innerHTML="请选择",this.dom.city.options[select].selected="selected";for(var i=0,len=htmlArr.length;len>i;i++)this.dom.city.options[i+1].value=htmlArr[i],this.dom.city.options[i+1].innerHTML=htmlArr[i]},sp.expeStore.getStores=function(){return this.data.stores},sp.expeStore.setStore=function(store){this.data.store=$trim(store)||""},sp.expeStore.getStoreIndex=function(){var store=-1,data=this.data;if(data.store)for(var city=this.getListStore(),i=0,len=city.length;len>i;i++)if(data.store===$trim(city[i].shopName)){store=i;break}return-1==store&&(store=0),store},sp.expeStore.getListStore=function(){var stores=[];if(this.data.district)if(this.data.city)if(this.data.store)stores=this.getStores();else{var tempStore=this.getStores();for(var prop in tempStore)stores=stores.concat(tempStore[prop])}else{var tempStore=this.getCities();for(var prop in tempStore)stores=stores.concat(tempStore[prop])}else stores=this.data.allStores;return this.data.listStores=stores},sp.expeStore.createList=function(){var tpl='<li class="serviceNet_li" expItem_tag="{%storeName%}"><p class="company">{%storeName%}</p><p>{%storeAddr%}</p><p>{%storeTel%}</p></li>',tpl_curr='<li class="serviceNet_li serviceNet_li_focus" expItem_tag="{%storeName%}"><p class="company">{%storeName%}</p><p>{%storeAddr%}</p><p>{%storeTel%}</p></li>',col=this.data.col,htmlArr=[],stores=this.getListStore();if(0===stores.length)return this.dom.list.innerHTML="无体验店",void 0;for(var tempStore,index=this.getStoreIndex(),index0=Math.floor(index/col)*col,i=index0,len=stores.length;len>i&&index0+col>i&&stores[i];i++)tempStore=stores[i],index===i?htmlArr.push(tpl_curr.replace(/\{\%storeName\%\}/g,tempStore.shopName).replace("{%storeAddr%}",tempStore.shopAddress).replace("{%storeTel%}",tempStore.shopTel)):htmlArr.push(tpl.replace(/\{\%storeName\%\}/g,tempStore.shopName).replace("{%storeAddr%}",tempStore.shopAddress).replace("{%storeTel%}",tempStore.shopTel));this.dom.list.innerHTML=htmlArr.join("")},sp.expeStore.createPages=function(total,col,curr){var tpl='<a href="#" page_tag="{%page%}">{%page%}</a>',tpl_pre='<a href="#"  page_tag="{%page%}" class="ui_page_prev">上一页</a>',tpl_next='<a href="#"  page_tag="{%page%}"  class="ui_page_next>下一页</a>',tpl_curr='<a href="#" page_tag="{%page%}"  class="ui_page_curr">{%page%}</a>';if(!total||!col||col>=total)return this.dom.pages.innerHTML="",this.dom.pages.style.display="none",void 0;curr=Math.ceil(curr/col),total=Math.ceil(total/col);var htmlArr=[];curr>1&&htmlArr.push(tpl_pre.replace("{%page%}",curr-1));for(var i=1;total>=i;i++)i===curr?htmlArr.push(tpl_curr.replace(/\{\%page\%\}/g,i)):htmlArr.push(tpl.replace(/\{\%page\%\}/g,i));total>curr&&htmlArr.push(tpl_next.replace("{%page%}",curr+1)),this.dom.pages.innerHTML=htmlArr.join(""),this.dom.pages.style.display="block"},sp.expeStore.createImages=function(imagesArr){if(this.dom.images.slide&&this.dom.images.slide.oOptions.unbind("mouseenter mouseleave"),!imagesArr||0==imagesArr.length)return this.dom.images.innerHTML="暂无体验店图片",void 0;for(var len=imagesArr.length,tpl_panel='<ul class="panel imgbox">{%panel%}</ul>',tpl_item='<li class="imglh"><img src="{%image%}" /></li>',tpl_options='<ul class="options imgnav">{%options%}</ul>',tpl_option="<li>{%num%}</li>",html_panel="",html_itemArr=Array(len),html_options="",html_optionArr=Array(len),i=0;len>i&&5>i&&imagesArr[i];i++)html_itemArr[i]=tpl_item.replace("{%image%}",imagesArr[i].image_url),html_optionArr[i]=tpl_option.replace("{%num%}",i+1);html_panel=tpl_panel.replace("{%panel%}",html_itemArr.join("")),html_options=tpl_options.replace("{%options%}",html_optionArr.join("")),this.dom.images.innerHTML=html_panel+html_options,this.dom.images.slide||(this.dom.images.slide=new $Tab({oTab:this.dom.images,config:{selectorItem:"li",selectorPanel:".panel",selectorOptions:".options",selectorOption:"li",cssOptionCurr:"curr"}})),this.dom.images.slide.init()},sp.expeStore.init();